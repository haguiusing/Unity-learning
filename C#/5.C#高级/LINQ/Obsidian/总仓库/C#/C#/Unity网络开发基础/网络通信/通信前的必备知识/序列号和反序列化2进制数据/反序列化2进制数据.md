![[Lesson4 2.cs]]

### 字节数组转非字符串类型
- 关键类：BitConverter
- 所在命名空间：System
- 主要作用：除字符串的其它常用类型和字节数组相互转换
```cs
byte[] byteArray1 = BitConverter.GetBytes(99);
int i = BitConverter.ToInt32(byteArray1, 0); // 第二个参数传从字节数组第几个字节开始转换 
print(i); // 99
```

### 字节数组转字符串类型
- 关键类：Encoding
- 所在命名空间：System.Text
- 主要作用：将字符串类型和字节数组相互转换，并且决定转换时使用的字符编码类型，网络通信时建议大家使用UTF-8类型
```cs
byte[] byteArray2 = Encoding.UTF8.GetBytes("人间自有韬哥在");
string str = Encoding.UTF8.GetString(byteArray2, 0, byteArray2.Length); // 第二个参数传从字节数组第几个字节开始转换 第三个参数是长度
print(str); // 人间自有韬哥在
```

### 如何将二进制数据转为一个类对象
#### 获取到对应的字节数组
```cs
PlayerInfo playerInfo1 = new PlayerInfo();
playerInfo1.lev = 10;
playerInfo1.name = "韬老狮";
playerInfo1.atk = 88;
playerInfo1.sex = false;

byte[] playerInfoBytes1 = playerInfo1.GetBytes(); // 使用上次封装好得到字节数组的方法得到字节数组
```

#### 将字节数组按照序列化时的顺序进行反序列化(将对应字节分组转换为对应类型变量)
```cs
PlayerInfo playerInfo2 = new PlayerInfo();

// 等级
int index = 0;
playerInfo2.lev = BitConverter.ToInt32(playerInfoBytes1, index);
index += 4; // 索引加上对应字节
print(playerInfo2.lev); // 10

// 姓名的长度
int length = BitConverter.ToInt32(playerInfoBytes1, index);
index += 4; // 索引加上对应字节

// 姓名字符串
playerInfo2.name = Encoding.UTF8.GetString(playerInfoBytes1, index, length);
index += length; // 索引加上对应字符串长度
print(playerInfo2.name); // 韬老狮

// 攻击力
playerInfo2.atk = BitConverter.ToInt16(playerInfoBytes1, index);
index += 2; // 索引加上对应字节
print(playerInfo2.atk); // 88

// 性别
playerInfo2.sex = BitConverter.ToBoolean(playerInfoBytes1, index);
index += 1; // 索引加上对应字节
print(playerInfo2.sex); // false
```

### 总结
- 我们对类对象的2进制反序列化主要用到的知识点是
    1. BitConverter转换字节数组为非字符串的类型的变量
    2. Encoding.UTF8转换字节数组为字符串类型的变量（注意：先读长度，再读字符串）
- 转换流程是
    1. 获取到对应的字节数组
    2. 将字节数组按照序列化时的顺序进行反序列化(将对应字节分组转换为对应类型变量)