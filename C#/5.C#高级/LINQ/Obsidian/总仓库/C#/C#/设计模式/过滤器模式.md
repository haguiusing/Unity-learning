## 过滤器模式
过滤器模式（Filter Pattern）或标准模式（Criteria Pattern）是一种设计模式，这种模式允许开发人员使用不同的标准来过滤一组对象，通过逻辑运算以解耦的方式把它们连接起来。这种类型的设计模式属于结构型模式，它结合多个标准来获得单一标准。

模式结构：
- Filter/Criteria：过滤器接口
- Concrete Filter/Concrete Criteria：具体过滤器类
- Items/Objects to be filtered：对象集合
- Client：客户端

过滤器模式包含以下几个主要角色：
- **过滤器接口（Filter/Criteria）**：定义一个接口，用于筛选对象。该接口通常包含一个方法，用于根据特定条件过滤对象。
- **具体过滤器类（Concrete Filter/Concrete Criteria）**：实现过滤器接口，具体定义筛选对象的条件和逻辑。
- **对象集合（Items/Objects to be filtered）**：要被过滤的对象集合。这些对象通常是具有共同属性的实例，例如一组人、一组产品等。
- **客户端（Client）**：使用具体过滤器类来筛选对象集合。客户端将对象集合和过滤器结合起来，以获得符合条件的对象。

![[20230510-filter.svg]]

- **`Person` 类**：表示人员对象，包含姓名、性别和婚姻状况。
- **`IFilter` 接口**：定义了过滤人员列表的标准。
- **`MaleFilter`、`FemaleFilter`、`SingleFilter` 类**：实现了 `IFilter` 接口，分别用于过滤男性、女性和单身人员。
- **`AndFilter` 和 `OrFilter` 类**：实现了 `IFilter` 接口，用于组合两个过滤器，分别表示逻辑与和逻辑或。
- **`Client` 类**：演示了如何使用不同的过滤器及其组合来过滤人员列表。

### 步骤 1：创建 Person 类
```csharp
//人员对象
public class Person
{
    public string Name { get; private set; }
    public string Gender { get; private set; }
    public string MaritalStatus { get; private set; }

    public Person(string name, string gender, string maritalStatus)
    {
        Name = name;
        Gender = gender;
        MaritalStatus = maritalStatus;
    }
}
```

### 步骤 2：创建过滤器接口
```csharp
using System.Collections.Generic;

//过滤人员列表的标准
public interface IFilter
{
    List<Person> MeetCriteria(List<Person> persons);
}
```

### 步骤 3：创建具体过滤器类
```csharp
using System.Collections.Generic;

//过滤男性
public class MaleFilter : IFilter
{
    public List<Person> MeetCriteria(List<Person> persons)
    {
        return persons.FindAll(person => person.Gender.Equals("Male", StringComparison.OrdinalIgnoreCase));
    }
}

//过滤女性
public class FemaleFilter : IFilter
{
    public List<Person> MeetCriteria(List<Person> persons)
    {
        return persons.FindAll(person => person.Gender.Equals("Female", StringComparison.OrdinalIgnoreCase));
    }
}

//过滤单身人员
public class SingleFilter : IFilter
{
    public List<Person> MeetCriteria(List<Person> persons)
    {
        return persons.FindAll(person => person.MaritalStatus.Equals("Single", StringComparison.OrdinalIgnoreCase));
    }
}

//组合两个过滤器，表示逻辑与
public class AndFilter : IFilter
{
    private readonly IFilter _firstFilter;
    private readonly IFilter _secondFilter;

    public AndFilter(IFilter firstFilter, IFilter secondFilter)
    {
        _firstFilter = firstFilter;
        _secondFilter = secondFilter;
    }

    public List<Person> MeetCriteria(List<Person> persons)
    {
        var firstResult = _firstFilter.MeetCriteria(persons);
        return _secondFilter.MeetCriteria(firstResult);
    }
}

//组合两个过滤器，表示逻辑或
public class OrFilter : IFilter
{
    private readonly IFilter _firstFilter;
    private readonly IFilter _secondFilter;

    public OrFilter(IFilter firstFilter, IFilter secondFilter)
    {
        _firstFilter = firstFilter;
        _secondFilter = secondFilter;
    }

    public List<Person> MeetCriteria(List<Person> persons)
    {
        var firstResult = _firstFilter.MeetCriteria(persons);
        var secondResult = _secondFilter.MeetCriteria(persons);
        var combinedResult = new List<Person>(firstResult);
        foreach (var person in secondResult)
        {
            if (!combinedResult.Contains(person))
            {
                combinedResult.Add(person);
            }
        }
        return combinedResult;
    }
}
```

### 步骤 4：创建客户端类
```csharp
using System;
using System.Collections.Generic;

public class Client
{
    public static void Main(string[] args)
    {
        var persons = new List<Person>
        {
            new Person("Robert", "Male", "Single"),
            new Person("John", "Male", "Married"),
            new Person("Laura", "Female", "Married"),
            new Person("Diana", "Female", "Single"),
            new Person("Mike", "Male", "Single"),
            new Person("Bobby", "Male", "Single")
        };

        IFilter maleFilter = new MaleFilter();
        IFilter femaleFilter = new FemaleFilter();
        IFilter singleFilter = new SingleFilter();
        IFilter singleMaleFilter = new AndFilter(singleFilter, maleFilter);
        IFilter singleOrFemaleFilter = new OrFilter(singleFilter, femaleFilter);

        Console.WriteLine("Males:");
        PrintPersons(maleFilter.MeetCriteria(persons));

        Console.WriteLine("\nFemales:");
        PrintPersons(femaleFilter.MeetCriteria(persons));

        Console.WriteLine("\nSingle Males:");
        PrintPersons(singleMaleFilter.MeetCriteria(persons));

        Console.WriteLine("\nSingle Or Females:");
        PrintPersons(singleOrFemaleFilter.MeetCriteria(persons));
    }

    private static void PrintPersons(List<Person> persons)
    {
        foreach (var person in persons)
        {
            Console.WriteLine($"Person : [ Name : {person.Name}, Gender : {person.Gender}, Marital Status : {person.MaritalStatus} ]");
        }
    }
}
```

### 运行结果
```cs
Males:
Person : [ Name : Robert, Gender : Male, Marital Status : Single ]
Person : [ Name : John, Gender : Male, Marital Status : Married ]
Person : [ Name : Mike, Gender : Male, Marital Status : Single ]
Person : [ Name : Bobby, Gender : Male, Marital Status : Single ]

Females:
Person : [ Name : Laura, Gender : Female, Marital Status : Married ]
Person : [ Name : Diana, Gender : Female, Marital Status : Single ]

Single Males:
Person : [ Name : Robert, Gender : Male, Marital Status : Single ]
Person : [ Name : Mike, Gender : Male, Marital Status : Single ]
Person : [ Name : Bobby, Gender : Male, Marital Status : Single ]

Single Or Females:
Person : [ Name : Robert, Gender : Male, Marital Status : Single ]
Person : [ Name : Diana, Gender : Female, Marital Status : Single ]
Person : [ Name : Mike, Gender : Male, Marital Status : Single ]
Person : [ Name : Bobby, Gender : Male, Marital Status : Single ]
Person : [ Name : Laura, Gender : Female, Marital Status : Married ]
```
