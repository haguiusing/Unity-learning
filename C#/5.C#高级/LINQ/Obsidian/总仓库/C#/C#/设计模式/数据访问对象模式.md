## 数据访问对象模式
数据访问对象模式（Data Access Object Pattern）或 DAO 模式用于把低级的数据访问 API 或操作从高级的业务服务中分离出来。以下是数据访问对象模式的参与者。
- **数据访问对象接口（Data Access Object Interface）** - 该接口定义了在一个模型对象上要执行的标准操作。
- **数据访问对象实体类（Data Access Object concrete class）** - 该类实现了上述的接口。该类负责从数据源获取数据，数据源可以是数据库，也可以是 xml，或者是其他的存储机制。
- **模型对象/数值对象（Model Object/Value Object）** - 该对象是简单的 POJO，包含了 get/set 方法来存储通过使用 DAO 类检索到的数据。

模式结构：
- DAOInterface：DAO接口
- DAOImplementation：DAO实现
- DataTransferObject, DTO：数据传输对象
- BusinessLogicLayer：业务逻辑层
- Data Source：数据源

包含的几个主要角色
1. **DAO接口（DAO Interface）**：
    - 声明数据访问和操作的方法。
2. **DAO实现（DAO Implementation）**：
    - 实现DAO接口，封装对数据源的所有访问逻辑。
3. **数据传输对象（Data Transfer Object, DTO）（可选）**：
    - 封装从数据源检索的数据，用于业务逻辑层与数据访问层之间的数据传输。
4. **业务逻辑层（Business Logic Layer）**：
    - 使用DAO接口与数据源交互，不直接依赖于数据访问的具体实现。
5. **数据源（Data Source）**：
    - 数据库或其他持久化存储，DAO实现与之交互以存取数据。

![[Pasted image 20250425170856.jpg]]

1. `Student` 类：数据传输对象（DTO），表示学生实体
2. `IStudentDao` 接口：DAO 接口，定义了数据访问的基本操作
3. `StudentDaoImpl` 类：DAO 实现，具体实现了 `IStudentDao` 接口，提供了数据访问的实现
4. `BusinessLogicLayer` 类：业务逻辑层，使用 DAO 来执行业务操作
5. `DaoPatternDemo` 类：客户端，演示如何使用 DAO 模式

``` cs
using System;
using System.Collections.Generic;

// DataTransferObject, DTO：数据传输对象
public class Student
{
    private string name;
    private int rollNo;

    public Student(string name, int rollNo)
    {
        this.name = name;
        this.rollNo = rollNo;
    }

    public string Name
    {
        get { return name; }
        set { name = value; }
    }

    public int RollNo
    {
        get { return rollNo; }
        set { rollNo = value; }
    }
}

// DAOInterface：DAO接口
public interface IStudentDao
{
    List<Student> GetAllStudents();
    Student GetStudent(int rollNo);
    void UpdateStudent(Student student);
    void DeleteStudent(Student student);
}

// DAOImplementation：DAO实现
public class StudentDaoImpl : IStudentDao
{
    // 列表是当作一个数据库
    private List<Student> students = new List<Student>();

    public StudentDaoImpl()
    {
        Student student1 = new Student("Robert", 0);
        Student student2 = new Student("John", 1);
        students.Add(student1);
        students.Add(student2);
    }

    public void DeleteStudent(Student student)
    {
        // 注意：此处为了简化，使用了 RollNo 作为索引，实际应用中可能需要更复杂的查找逻辑
        students.RemoveAt(student.RollNo);
        Console.WriteLine($"Student: Roll No {student.RollNo}, deleted from database");
    }

    // 从数据库中检索学生名单
    public List<Student> GetAllStudents()
    {
        return students;
    }

    public Student GetStudent(int rollNo)
    {
        // 注意：此处为了简化，使用了 RollNo 作为索引，实际应用中可能需要更复杂的查找逻辑
        return students[rollNo];
    }

    public void UpdateStudent(Student student)
    {
        // 注意：此处为了简化，使用了 RollNo 作为索引，实际应用中可能需要更复杂的查找逻辑
        students[student.RollNo].Name = student.Name;
        Console.WriteLine($"Student: Roll No {student.RollNo}, updated in the database");
    }
}

// BusinessLogicLayer：业务逻辑层
public class BusinessLogicLayer
{
    private IStudentDao studentDao;

    public BusinessLogicLayer(IStudentDao studentDao)
    {
        this.studentDao = studentDao;
    }

    public void DisplayAllStudents()
    {
        foreach (Student student in studentDao.GetAllStudents())
        {
            Console.WriteLine($"Student: [RollNo: {student.RollNo}, Name: {student.Name}]");
        }
    }

    public void UpdateStudentName(int rollNo, string newName)
    {
        Student student = studentDao.GetStudent(rollNo);
        student.Name = newName;
        studentDao.UpdateStudent(student);
    }

    public void DeleteStudent(int rollNo)
    {
        Student student = studentDao.GetStudent(rollNo);
        studentDao.DeleteStudent(student);
    }
}

// Client：客户端
public class DaoPatternDemo
{
    public static void Main(string[] args)
    {
        IStudentDao studentDao = new StudentDaoImpl();
        BusinessLogicLayer businessLogic = new BusinessLogicLayer(studentDao);

        // 输出所有的学生
        businessLogic.DisplayAllStudents();

        // 更新学生
        businessLogic.UpdateStudentName(0, "Michael");

        // 获取学生
        Student student = studentDao.GetStudent(0);
        Console.WriteLine($"Student: [RollNo: {student.RollNo}, Name: {student.Name}]");
    }
}
```

执行该程序后，输出结果：
```
Student: [RollNo: 0, Name: Robert]
Student: [RollNo: 1, Name: John]
Student: Roll No 0, updated in the database
Student: [RollNo: 0, Name: Michael]
```