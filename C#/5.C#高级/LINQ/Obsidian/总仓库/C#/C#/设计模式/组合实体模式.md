## 组合实体模式
组合实体模式（Composite Entity Pattern）用在 EJB 持久化机制中。一个组合实体是一个 EJB 实体 bean，代表了对象的图解。当更新一个组合实体时，内部依赖对象 beans 会自动更新，因为它们是由 EJB 实体 bean 管理的。以下是组合实体 bean 的参与者。
- **组合实体（Composite Entity）** - 它是主要的实体 bean。它可以是粗粒的，或者可以包含一个粗粒度对象，用于持续生命周期。
- **粗粒度对象（Coarse-Grained Object）** - 该对象包含依赖对象。它有自己的生命周期，也能管理依赖对象的生命周期。
- **依赖对象（Dependent Object）** - 依赖对象是一个持续生命周期依赖于粗粒度对象的对象。
- **策略（Strategies）** - 策略表示如何实现组合实体。

模式结构：
- CompositeEntity：组合实体
- Leaf Entity：叶子实体
- ContainerEntity：容器实体
- DataAccessObject：数据访问对象
- Client：客户端

包含的几个主要角色
- **组合实体（Composite Entity）**：
    - 代表数据库中的表，可以包含单个或多个记录。
- **叶子实体（Leaf Entity）**：
    - 代表表中的单个记录，不包含子实体。
- **容器实体（Container Entity）**：
    - 代表表中的一组记录，可以包含其他叶子或容器实体。
- **数据访问对象（Data Access Object）（可选）**：
    - 用于访问和操作数据库，封装了数据访问逻辑。
- **客户端（Client）（可选）**：
    - 使用组合实体模式来访问和操作数据库记录。

![[Pasted image 20250425170406.jpg]]

1. `DependentObject1` 和 `DependentObject2` 类：叶子实体，表示被组合的细粒度对象
2. `CoarseGrainedObject` 类：容器实体，表示粗粒度的组合对象，包含多个叶子实体
3. `CompositeEntity` 类：组合实体，提供一个统一的接口来访问组合中的叶子实体
4. `Client` 类：客户端，使用组合实体来设置和获取数据
5. `CompositeEntityPatternDemo` 类：演示类，用于演示组合实体模式的使用

```cs
using System;

// Leaf Entity：叶子实体
public class DependentObject1
{
    private string data;

    public void SetData(string data)
    {
        this.data = data;
    }

    public string GetData()
    {
        return data;
    }
}

// Leaf Entity：叶子实体
public class DependentObject2
{
    private string data;

    public void SetData(string data)
    {
        this.data = data;
    }

    public string GetData()
    {
        return data;
    }
}

// ContainerEntity：容器实体
public class CoarseGrainedObject
{
    private DependentObject1 do1 = new DependentObject1();
    private DependentObject2 do2 = new DependentObject2();

    public void SetData(string data1, string data2)
    {
        do1.SetData(data1);
        do2.SetData(data2);
    }

    public string[] GetData()
    {
        return new string[] { do1.GetData(), do2.GetData() };
    }
}

// CompositeEntity：组合实体
public class CompositeEntity
{
    private CoarseGrainedObject cgo = new CoarseGrainedObject();

    public void SetData(string data1, string data2)
    {
        cgo.SetData(data1, data2);
    }

    public string[] GetData()
    {
        return cgo.GetData();
    }
}

// Client：客户端
public class Client
{
    private CompositeEntity compositeEntity = new CompositeEntity();

    public void PrintData()
    {
        foreach (var data in compositeEntity.GetData())
        {
            Console.WriteLine("Data: " + data);
        }
    }

    public void SetData(string data1, string data2)
    {
        compositeEntity.SetData(data1, data2);
    }
}

// 使用 Client 来演示组合实体设计模式的用法
public class CompositeEntityPatternDemo
{
    public static void Main(string[] args)
    {
        Client client = new Client();
        client.SetData("Test", "Data");
        client.PrintData();
        client.SetData("Second Test", "Data1");
        client.PrintData();
    }
}
```


执行该程序后，输出结果与原始 Java 版本相同：
```cs
Data: Test
Data: Data
Data: Second Test
Data: Data1
```