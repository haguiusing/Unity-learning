### ILRuntime导入，开启unsafe
- Name: ILRuntime
- Url: [https://registry.npmjs.org](https://registry.npmjs.org/)
- Scopes: com.ourpalm
![](https://linwentao785293209.github.io/images/%E7%83%AD%E6%9B%B4%E6%96%B0/Unity/ILRuntime/02.ILRuntime%E5%AE%9E%E8%B7%B5%E9%A1%B9%E7%9B%AE/1.%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9%E5%AF%BC%E5%85%A5/1.png)

### AB包工具导入
![](https://linwentao785293209.github.io/images/%E7%83%AD%E6%9B%B4%E6%96%B0/Unity/ILRuntime/02.ILRuntime%E5%AE%9E%E8%B7%B5%E9%A1%B9%E7%9B%AE/1.%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9%E5%AF%BC%E5%85%A5/2.png)

### 基础框架、AB包和AB包上传下载相关代码导入
![[ABMgr.cs]]![[ABUpdateMgr.cs]]

![](https://linwentao785293209.github.io/images/%E7%83%AD%E6%9B%B4%E6%96%B0/Unity/ILRuntime/02.ILRuntime%E5%AE%9E%E8%B7%B5%E9%A1%B9%E7%9B%AE/1.%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9%E5%AF%BC%E5%85%A5/3.png)

### 删除热更Demo中无用信息，报错代码注释了就行，可以方便之后假如写的话有模版对应
![](https://linwentao785293209.github.io/images/%E7%83%AD%E6%9B%B4%E6%96%B0/Unity/ILRuntime/02.ILRuntime%E5%AE%9E%E8%B7%B5%E9%A1%B9%E7%9B%AE/1.%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9%E5%AF%BC%E5%85%A5/4.png)

![](https://linwentao785293209.github.io/images/%E7%83%AD%E6%9B%B4%E6%96%B0/Unity/ILRuntime/02.ILRuntime%E5%AE%9E%E8%B7%B5%E9%A1%B9%E7%9B%AE/1.%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9%E5%AF%BC%E5%85%A5/5.png)

### 修改AssetBundleManager中加载路径相关代码，改成先判断持久文件夹有没有相关的包或清单
```cs
private string StreamingUrl
{
    get { return Application.streamingAssetsPath + "/"; }
}

private string PersistentUrl
{
    get { return Application.persistentDataPath + "/"; }
}

/// <summary>
/// 加载主 AssetBundle 和 AssetBundle 清单
/// </summary>
private void LoadMainAssetBundleAndAssetBundleManifest()
{
    if (mainAssetBundle == null)
    {
        string path = File.Exists(PersistentUrl + mainAssetBundleName)
            ? PersistentUrl + mainAssetBundleName
            : StreamingUrl + mainAssetBundleName;
        mainAssetBundle = AssetBundle.LoadFromFile(path);
        assetBundleManifest = mainAssetBundle.LoadAsset<AssetBundleManifest>("AssetBundleManifest");
    }
}

/// <summary>
/// 加载 AssetBundle 的依赖项
/// </summary>
private void LoadAssetBundleDependencies(string assetBundleName)
{
    LoadMainAssetBundleAndAssetBundleManifest();

    string[] strs = assetBundleManifest.GetAllDependencies(assetBundleName);
    for (int i = 0; i < strs.Length; i++)
    {
        if (!assetBundleDictionary.ContainsKey(strs[i]))
        {
            string path = File.Exists(PersistentUrl + strs[i])
                ? PersistentUrl + strs[i]
                : StreamingUrl + strs[i];
            AssetBundle ab = AssetBundle.LoadFromFile(path);
            assetBundleDictionary.Add(strs[i], ab);
        }
    }
}

/// <summary>
/// 加载目标 AssetBundle
/// </summary>
private void LoadAssetBundleTarget(string assetBundleName)
{
    if (!assetBundleDictionary.ContainsKey(assetBundleName))
    {
        string path = File.Exists(PersistentUrl + assetBundleName)
            ? PersistentUrl + assetBundleName
            : StreamingUrl + assetBundleName;
        AssetBundle assetBundle = AssetBundle.LoadFromFile(path);
        assetBundleDictionary.Add(assetBundleName, assetBundle);
    }
}
```