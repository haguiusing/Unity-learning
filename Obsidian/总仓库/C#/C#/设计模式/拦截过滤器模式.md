## 拦截过滤器模式
拦截过滤器模式（Intercepting Filter Pattern）用于对应用程序的请求或响应做一些预处理/后处理。定义过滤器，并在把请求传给实际目标应用程序之前应用在请求上。过滤器可以做认证/授权/记录日志，或者跟踪请求，然后把请求传给相应的处理程序。以下是这种设计模式的实体。
- **过滤器（Filter）** - 过滤器在请求处理程序执行请求之前或之后，执行某些任务。
- **过滤器链（Filter Chain）** - 过滤器链带有多个过滤器，并在 Target 上按照定义的顺序执行这些过滤器。
- **Target** - Target 对象是请求处理程序。
- **过滤管理器（Filter Manager）** - 过滤管理器管理过滤器和过滤器链。
- **客户端（Client）** - Client 是向 Target 对象发送请求的对象。

模式结构：
- FilterInterface：过滤器接口
- Concrete Filter：具体过滤器
- Filter Manager：过滤器管理器
- Target：目标对象
- Client：客户端

包含的几个主要角色
1. **过滤器接口（Filter Interface）**：
    - 定义了过滤器必须实现的方法。
2. **具体过滤器（Concrete Filter）**：
    - 实现过滤器接口，包含具体的处理逻辑。
3. **过滤器管理器（Filter Manager）**：
    - 负责维护过滤器链和调用过滤器。
4. **目标对象（Target）**：
    - 请求处理的最终目的地，业务逻辑的实现。
5. **客户端（Client）（可选）**：
    - 发出请求的Web浏览器或API客户端。

![[20201015-intercepting.svg]]

1. `IFilter` 接口：过滤器接口，定义了过滤器的基本方法
2. `AuthenticationFilter` 和 `DebugFilter` 类：具体过滤器，实现了 `IFilter` 接口并提供了具体的过滤逻辑
3. `Target` 类：目标对象，表示最终处理请求的对象
4. `FilterChain` 类：过滤链，负责维护过滤器的顺序，并将请求依次通过每个过滤器
5. `FilterManager` 类：过滤器管理器，负责管理过滤链和目标对象
6. `Client` 类：客户端，通过过滤器管理器发送请求
7. `InterceptingFilterDemo` 类：演示类，用于演示拦截过滤器模式的使用

```cs
using System;
using System.Collections.Generic;

// FilterInterface：过滤器接口
public interface IFilter
{
    void Execute(string request);
}

// Concrete Filter：具体过滤器
// AuthenticationFilter类
public class AuthenticationFilter : IFilter
{
    public void Execute(string request)
    {
        Console.WriteLine("Authenticating request: " + request);
    }
}

// DebugFilter类
public class DebugFilter : IFilter
{
    public void Execute(string request)
    {
        Console.WriteLine("request log: " + request);
    }
}

// Target：目标对象
public class Target
{
    public void Execute(string request)
    {
        Console.WriteLine("Executing request: " + request);
    }
}

// FilterChain：过滤链
public class FilterChain
{
    private List<IFilter> filters = new List<IFilter>();
    private Target target;

    public void AddFilter(IFilter filter)
    {
        filters.Add(filter);
    }

    public void Execute(string request)
    {
        foreach (IFilter filter in filters)
        {
            filter.Execute(request);
        }
        target.Execute(request);
    }

    public void SetTarget(Target target)
    {
        this.target = target;
    }
}

// Filter Manager：过滤器管理器
public class FilterManager
{
    private FilterChain filterChain;

    public FilterManager(Target target)
    {
        filterChain = new FilterChain();
        filterChain.SetTarget(target);
    }

    public void SetFilter(IFilter filter)
    {
        filterChain.AddFilter(filter);
    }

    public void FilterRequest(string request)
    {
        filterChain.Execute(request);
    }
}

// Client：客户端
public class Client
{
    private FilterManager filterManager;

    public void SetFilterManager(FilterManager filterManager)
    {
        this.filterManager = filterManager;
    }

    public void SendRequest(string request)
    {
        filterManager.FilterRequest(request);
    }
}

// 使用 Client 来演示拦截过滤器设计模式
public class InterceptingFilterDemo
{
    public static void Main(string[] args)
    {
        FilterManager filterManager = new FilterManager(new Target());
        filterManager.SetFilter(new AuthenticationFilter());
        filterManager.SetFilter(new DebugFilter());

        Client client = new Client();
        client.SetFilterManager(filterManager);
        client.SendRequest("HOME");
    }
}
```

执行该程序后，输出结果：
```cs
Authenticating request: HOME
request log: HOME
Executing request: HOME
```