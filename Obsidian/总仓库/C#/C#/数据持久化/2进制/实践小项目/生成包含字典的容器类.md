![[读取Excel目录下所有Excel文件#^a9db9b]]

定义容器类脚本存储位置路径
```cs
/// <summary>
/// 容器类脚本存储位置路径
/// </summary>
public static string DATA_CONTAINER_PATH = Application.dataPath + "/Scripts/ExcelData/Container/";
```

创建生成Excel表对应的数据容器类函数，在生成Excel信息的菜单项函数调用
```cs
/// <summary>
/// 生成Excel表对应的数据容器类
/// </summary>
/// <param name="table"></param>
private static void GenerateExcelContainer(DataTable table)
{
    // 生成Excel信息的菜单项函数
    [MenuItem("GameTool/GenerateExcel")]
    private static void GenerateExcelInfo()
    {
        ...
        // 遍历文件中的所有表的信息
        foreach (DataTable table in tableConllection)
        {
            Debug.Log(table.TableName);

            // 生成数据结构类
            GenerateExcelDataClass(table);

            // 生成容器类
            GenerateExcelContainer(table);

            // 生成二进制数据
        }
    }
}


/// <summary>
/// 生成Excel表对应的数据容器类
/// </summary>
/// <param name="table"></param>
private static void GenerateExcelContainer(DataTable table)
{

}
```

创建获取主键索引函数，方便等一下在生成Excel表对应的数据容器类函数调用。获取表的第三行数据（索引从0开始），即字段类型所在行，遍历表的所有列，判断当前列的值是否等于”key”，如果是主键列，则返回列索引， 如果没有找到主键列，则返回默认值0。
```cs
/// <summary>
/// 获取主键索引
/// </summary>
/// <param name="table"></param> // 传入一个DataTable对象，表示数据表
/// <returns></returns> // 返回一个整型值，表示主键所在的列索引
private static int GetKeyIndex(DataTable table)
{
    // 获取表的第三行数据（索引从0开始），即字段类型所在行
    DataRow row = table.Rows[2];

    // 遍历表的所有列
    for (int i = 0; i < table.Columns.Count; i++)
    {
        // 判断当前列的值是否等于"key"，即判断是否是主键列
        if (row[i].ToString() == "key")
            return i; // 如果是主键列，则返回列索引
    }

    // 如果没有找到主键列，则返回默认值0
    return 0;
}
```

在生成Excel表对应的数据容器类函数中，通过获取主键索引函数获得组件索引。 获取字段类型所在行。判断容器存储路径存不存在，如果路径不存在，则创建路径。字符串拼接容器类，导入所需命名空间，生成数据容器类的代码字符串，声明数据字典并初始化。将代码字符串写入文件，文件名为表名加上”Container.cs”。刷新Unity的Project窗口。
```cs
/// <summary>
/// 生成Excel表对应的数据容器类
/// </summary>
/// <param name="table"></param>
private static void GenerateExcelContainer(DataTable table)
{
    // 获取主键索引
    int keyIndex = GetKeyIndex(table);

    // 获取字段类型所在行
    DataRow rowType = GetVariableTypeRow(table);

    // 如果路径不存在，则创建路径
    if (!Directory.Exists(DATA_CONTAINER_PATH))
        Directory.CreateDirectory(DATA_CONTAINER_PATH);

    // 导入所需命名空间
    string str = "using System.Collections.Generic;\n";

    // 生成数据容器类的代码字符串
    str += "public class " + table.TableName + "Container" + "\n{\n";

    // 声明数据字典并初始化
    str += "    ";
    str += "public Dictionary<" + rowType[keyIndex].ToString() + ", " + table.TableName + ">";
    str += "dataDic = new " + "Dictionary<" + rowType[keyIndex].ToString() + ", " + table.TableName + ">();\n";

    str += "}";

    // 将代码字符串写入文件，文件名为表名加上"Container.cs"
    File.WriteAllText(DATA_CONTAINER_PATH + table.TableName + "Container.cs", str);

    // 刷新Unity的Project窗口
    AssetDatabase.Refresh();
}
```