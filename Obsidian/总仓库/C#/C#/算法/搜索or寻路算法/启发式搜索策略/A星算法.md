## A*
A*算法在机器人、导航、游戏等领域有广泛的应用。A*可以说是Dijkstra的改进版，目的在于解决Dijkstra效率低的问题，上面说到Dijkstra不知道目标节点的位置，所以只能向所有方向扩展直到发现目标节点。之前提到的GBFS算法的缺点在于，过分关注目标点的位置，即GBFS每次访问的节点具有到目标节点的最小代价，但是在有障碍物的情况下路径不是最优解。

两者取长补短，诞生了A*算法，A*同时借鉴了两种算法，在Dijkstra基础上引入了启发式函数h(n)， h(n)表示了当前节点到目标节点的成本。保证了最优性的同时，加入了目标节点的信息，提升了效率。

g(n): 对从初始节点到节点n的累计成本的当前最佳估计。
h(n): 节点n到目标节点的代价估计（即目标代价）。
f(n) = g(n) + h(n) ： 从初始节点，通过当前节点n，再到目标节点的代价估计。

策略：每次访问容器中f(n)最小的节点

伪代码跟上面Dijkstra 的一样，只不过下一节点变成了f(n)最低的节点。
![](https://pica.zhimg.com/v2-267c253de06ef20c7fd8fb46ac3e552e_1440w.jpg)

### A*具有完备性的条件如下
![](https://pic1.zhimg.com/v2-51b423ec081d17b24b0785e63f75c7b4_1440w.jpg)

当h(n)<= h*(n)时，这里h*(n)指节点n到目标节点的真实代价。

关于h(n)的两种取法：欧氏距离和曼哈顿距离，是否满足A*的最优性。

上图中红色为真实代价h*(n)，黑色为欧氏距离作为h(n)的估计代价，黄色是采用曼哈顿距离作为h(n)的估计代价。显然，采用欧氏距离，一定满足h(n)<=h*(n)

当只考虑上下左右四格方向时，曼哈顿距离满足h(n) <= h*(n)，若可沿对角线移动，曼哈顿距离不一定满足。

## Dijkstra和A*对比
![](https://picx.zhimg.com/v2-d4c02ea299ef8b5167da46603a0b72e7_1440w.jpg)

总的来说，A*是一个带有启发性的Dijkstra算法。

- 当h(n) = 0时，即f(n) = g(n)， A*就退化为Dijkstra。
- 当h(n) <h*(n)时，A*可以找到最短路径，但是搜索效率低，h(n)越小，意味着需要扩展的中间节点越多，效率越低，但是精度更准确，因为此时更趋近于Dijkstra算法。
- 当h(n) = h*(n)时，可以兼顾精度和速度，是最优状态。
- 当h(n) >> g(n)时，那么f(n)主要取决于h(n) ,此时A*退化为GBFS。

## A*的优化

欧氏距离：

![](https://pic1.zhimg.com/v2-f92a943e46cf2827454721b64f222bf6_1440w.jpg)

上图是采用欧氏距离作为h(n)的A*路径，过程中扩展了很多没必要的节点。原因是欧氏距离计算的h(n) << h*(n),此时h(n)会引导扩展很多不必要的节点。实际上，对于无障碍下的真实目标代价h(n)是闭式解的。

闭式解：

dx = abs(node.x - goal.x)

dy = abs(node.y - goal.y)

h = (dx + dy) + (根2 - 2）* min(dx, dy)

![](https://pic2.zhimg.com/v2-95dd9a322183e9eeecf4dd179f8917d7_1440w.jpg)

---

![](https://pic2.zhimg.com/v2-91b798afc9cd6f5ec4bc0b11c85aa461_1440w.jpg)

途中两点A，B具有相同的f(n)，即f(A) = f(B),此时A*不具有倾向性，它会依次分别扩展两个节点，导致计算浪费在扩展无用节点上。

针对这种情况，我们可以考虑打破对称，让A*算法具有某种倾向性，来减少无用节点的扩展。最简单的做法是将h(n)值略微放大，这样做大多数情况下没问题，因为真实环境中有很多障碍物，h一般远远小于h*，所以略微放大一些不会很大地影响算法的完备性。

h = h * (1.0 + p)

p < 走一步的最小代价 / 预期最大路径消耗

除此之外，也可以倾向选择离起点终点连线距离更近的节点：

dx1 = abs(node.x - goal.x)

dy1 = abs(node.y - goal.y)

dx2 = abs(start.x - goal.x)

dy2 = abs(start.y - goal.y)

cross = abs(dx1 * dy2 - dx2*dy1)

h = h+cross*0.001

总之，新思路是打破平衡性，增强A*的目的性。